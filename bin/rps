#!/usr/bin/env ruby
require_relative '../lib/rock_paper_scissors.rb'

options = {rounds: 3}
OptionParser.new do |o|
  o.on('-r', '--rounds=N', Integer, "Best of N rounds", "Default is 3") do |f|
    abort("Please use an odd number") if f.even?
    options[:rounds] = f
  end
end.parse!(ARGV)

game = RockPaperScissors.new(options)

puts ">> FIRST TO #{game.points_to_win} WINS! <<"

until game.game_winner?
  puts "\nCurrent score: #{game.score.inspect}"
  print "What is your choice? (r)ock, (p)aper, or (s)cissors?: "
  u_choice = game.user_choice($stdin.gets.chomp.downcase)
  c_choice = game.computer_choice

  if u_choice == :exit
    break
  elsif !u_choice
    puts "Please enter a valid choice!"
    next
  end

  {user: u_choice, computer: c_choice}.each { |k,v| puts "> #{k} chose #{v}" }

  puts "Round winner: #{game.round_winner(u_choice, c_choice)}"
end

puts game.game_winner ? "\nGame over! #{game.game_winner} won!" :
  "\nGame was quit. Score was #{game.score.inspect}"

